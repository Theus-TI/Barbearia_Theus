<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Barbearia Theus - Agende seu horário com nossos barbeiros especializados em cortes clássicos e modernos">
    <title>Barbearia Theus - Agende seu Horário</title>
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Teko:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0a0a0a;
        }
        .font-teko {
            font-family: 'Teko', sans-serif;
        }
        .hero-bg {
            background-image: linear-gradient(to top, rgba(10, 10, 10, 1) 0%, rgba(10, 10, 10, 0.8) 50%, rgba(10, 10, 10, 1) 100%), url('https://images.unsplash.com/photo-1599351431202-1aa5a4848c8a?q=80&w=1974&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .section-bg {
            background-color: #111111;
        }
    </style>
</head>
<body class="bg-black text-white">

    <!-- Header -->
    <header class="bg-black/80 backdrop-blur-sm fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4">
            <nav class="flex justify-between items-center py-4">
                <a href="#" class="text-3xl font-bold font-teko text-white tracking-wider">BARBEARIA THEUS</a>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#inicio" class="text-gray-300 hover:text-white transition-colors">Início</a>
                    <a href="#servicos" class="text-gray-300 hover:text-white transition-colors">Serviços</a>
                    <a href="#equipe" class="text-gray-300 hover:text-white transition-colors">Equipe</a>
                    <a href="#contato" class="text-gray-300 hover:text-white transition-colors">Contato</a>
                </div>
                <div class="hidden md:flex items-center space-x-4" id="auth-area">
                    <a id="loginBtn" href="login.html" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-sm hover:bg-amber-700 transition-colors">LOGIN / AGENDAR</a>
                    <div id="userArea" class="hidden items-center space-x-3">
                        <span class="text-gray-300">Olá, <span id="userName" class="text-white font-bold"></span></span>
                        <a href="agendamento.html" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-sm hover:bg-amber-700 transition-colors">AGENDAR</a>
                        <button id="logoutBtn" class="text-gray-400 hover:text-white">Sair</button>
                    </div>
                    <button id="adminMenuButton" class="hidden text-white hover:text-amber-500" title="Painel Admin">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
                <button id="mobile-menu-button" class="md:hidden text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </nav>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <a href="#inicio" class="block text-gray-300 hover:text-white p-4">Início</a>
            <a href="#servicos" class="block text-gray-300 hover:text-white p-4">Serviços</a>
            <a href="#equipe" class="block text-gray-300 hover:text-white p-4">Equipe</a>
            <a href="#contato" class="block text-gray-300 hover:text-white p-4">Contato</a>
            <a id="mobileLoginLink" href="login.html" class="block bg-amber-600 text-white font-bold m-4 py-2 px-6 rounded-sm hover:bg-amber-700 transition-colors text-center">LOGIN / AGENDAR</a>
            <div id="mobileUserArea" class="hidden m-4 p-4 border border-gray-800 rounded text-center space-y-3">
                <div class="text-gray-300">Olá, <span id="mobileUserName" class="text-white font-bold"></span></div>
                <a href="agendamento.html" class="block bg-amber-600 text-white font-bold py-2 px-6 rounded-sm hover:bg-amber-700 transition-colors">AGENDAR</a>
                <button id="mobileLogoutBtn" class="w-full text-gray-400 hover:text-white">Sair</button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="inicio" class="hero-bg h-screen flex items-center justify-center text-white text-center">
        <div class="container mx-auto px-4">
            <h1 class="font-teko text-6xl md:text-8xl font-bold tracking-widest">TRADIÇÃO E MODERNIDADE</h1>
            <p class="text-lg md:text-xl text-gray-300 mt-2 mb-8 max-w-2xl mx-auto">Onde cada corte é uma obra de arte e cada cliente é um rei. Bem-vindo à sua nova experiência em barbearia.</p>
            <a href="login.html" class="bg-amber-600 text-white font-bold py-3 px-10 rounded-sm hover:bg-amber-700 transition-colors text-lg">FAÇA SEU AGENDAMENTO</a>
        </div>
    </section>

    <!-- Services Section -->
    <section id="servicos" class="section-bg py-20">
        <div class="container mx-auto px-4 text-center text-white">
            <h2 class="font-teko text-5xl font-semibold mb-2">NOSSOS SERVIÇOS</h2>
            <p class="text-gray-400 mb-12">Do clássico ao contemporâneo, temos o serviço perfeito para você.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Service Card 1 -->
                <div class="bg-black/50 p-8 rounded-lg border border-gray-800">
                    <img src="assets/corte.jpg" alt="Corte de Cabelo" class="w-full h-40 object-cover rounded mb-4" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/800x320/111111/FFA500?text=Corte+de+Cabelo';">
                    <h3 class="font-teko text-2xl text-amber-500 mb-2">CORTE DE CABELO</h3>
                    <p class="text-gray-400">Estilo personalizado com tesoura e máquina, finalizado com os melhores produtos.</p>
                </div>
                <!-- Service Card 2 -->
                <div class="bg-black/50 p-8 rounded-lg border border-gray-800">
                    <img src="assets/barba.jpg" alt="Design de Barba" class="w-full h-40 object-cover rounded mb-4" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/800x320/111111/FFA500?text=Design+de+Barba';">
                    <h3 class="font-teko text-2xl text-amber-500 mb-2">DESIGN DE BARBA</h3>
                    <p class="text-gray-400">Modelagem profissional, toalha quente e navalha para um acabamento impecável.</p>
                </div>
                <!-- Service Card 3 -->
                <div class="bg-black/50 p-8 rounded-lg border border-gray-800">
                    <img src="assets/combo.jpg" alt="Combo (Cabelo + Barba)" class="w-full h-40 object-cover rounded mb-4" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/800x320/111111/FFA500?text=Combo';">
                    <h3 class="font-teko text-2xl text-amber-500 mb-2">COMBO (CABELO + BARBA)</h3>
                    <p class="text-gray-400">A experiência completa para um visual renovado e alinhado.</p>
                </div>
                <!-- Service Card 4 -->
                <div class="bg-black/50 p-8 rounded-lg border border-gray-800">
                    <img src="assets/tratamento.jpg" alt="Tratamento Capilar" class="w-full h-40 object-cover rounded mb-4" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/800x320/111111/FFA500?text=Tratamento+Capilar';">
                    <h3 class="font-teko text-2xl text-amber-500 mb-2">TRATAMENTO CAPILAR</h3>
                    <p class="text-gray-400">Hidratação e fortalecimento para manter seus cabelos saudáveis e fortes.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Team Section -->
    <section id="equipe" class="py-20">
        <div class="container mx-auto px-4 text-center text-white">
            <h2 class="font-teko text-5xl font-semibold mb-2">NOSSA EQUIPE</h2>
            <p class="text-gray-400 mb-12">Profissionais apaixonados pelo que fazem, prontos para te atender.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-4xl mx-auto">
                <!-- Team Member 1 -->
                <div class="text-center">
                    <img src="assets/rafa.jpg" alt="Rafa" class="w-48 h-48 rounded-full mx-auto mb-4 object-cover border-4 border-amber-600" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/192x192/111111/FFA500?text=Rafa';">
                    <h3 class="font-teko text-3xl">Rafa</h3>
                    <p class="text-amber-500">Barbeiro Chefe</p>
                    <p class="text-gray-400 mt-2">Com mais de 15 anos de experiência, Rafa é especialista em cortes clássicos e um mestre da navalha.</p>
                </div>
                <!-- Team Member 2 -->
                <div class="text-center">
                    <img src="assets/tteu.jpg" alt="Tteu" class="w-48 h-48 rounded-full mx-auto mb-4 object-cover border-4 border-amber-600" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/192x192/111111/FFA500?text=Tteu';">
                    <h3 class="font-teko text-3xl">Tteu</h3>
                    <p class="text-amber-500">Barbeiro Jr.</p>
                    <p class="text-gray-400 mt-2">Antenado nas últimas tendências, Tteu é o cara certo para cortes modernos, fades e desenhos.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contato" class="section-bg py-20">
        <div class="container mx-auto px-4 text-center text-white">
            <h2 class="font-teko text-5xl font-semibold mb-2">ONDE ESTAMOS</h2>
            <p class="text-gray-400 mb-12">Venha nos visitar e tomar um café.</p>
            <p class="text-lg">Rua da Barbearia, 123 - Centro, Sua Cidade - SP</p>
            <p class="text-lg mt-2">Telefone: (11) 99999-8888</p>
            <div class="mt-8">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3657.14590155926!2d-46.65657118440696!3d-23.56309936754375!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94ce59c8da0aa315%3A0x206d05a8f38da8ec!2sAv.%20Paulista%2C%20S%C3%A3o%20Paulo%20-%20SP!5e0!3m2!1spt-BR!2sbr!4v1672856981101!5m2!1spt-BR!2sbr" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" class="rounded-lg border-2 border-gray-800"></iframe>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black py-6">
        <div class="container mx-auto px-4 text-center text-gray-500">
            <p>&copy; 2025 Barbearia Theus. Todos os direitos reservados.</p>
            <p>Desenvolvido com ❤️ por você e Cascade</p>
        </div>
    </footer>

    <script>
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });

        function isTokenValid(token) { if (!token) return false; const parts = token.split('.'); if (parts.length !== 3) return false; try { const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/'))); if (!payload.exp) return false; return payload.exp * 1000 > Date.now(); } catch { return false; } }
        function getPayload(token) { const parts = token.split('.'); return JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/'))); }
        function getToken() { return localStorage.getItem('token'); }
        function formatBRL(v) { try { return Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); } catch { return 'R$ 0,00'; } }

        let adminUI = null;
        function createAdminPanel() {
            if (document.getElementById('adminOverlay')) return adminUI;
            const overlay = document.createElement('div');
            overlay.id = 'adminOverlay';
            overlay.className = 'fixed inset-0 z-[60] hidden';
            overlay.innerHTML = `
               <div class="absolute inset-0 bg-black/50" id="adminOverlayBg"></div>
               <div class="absolute right-0 top-0 h-full w-full sm:w-[520px] bg-[#0b0b0b] border-l border-gray-800 overflow-y-auto" id="adminDrawer">
                 <div class="flex items-center justify-between p-4 border-b border-gray-800 sticky top-0 bg-[#0b0b0b] z-10">
                  <div class="flex items-center space-x-2">
                    <span class="text-xl font-teko tracking-widest">PAINEL ADMIN</span>
                    <span id="adminUserName" class="text-gray-400 text-sm"></span>
                  </div>
                  <button id="adminClose" class="text-gray-400 hover:text-white">&times;</button>
                 </div>
                 <div class="p-4 space-y-4">
                   <div class="flex items-center justify-between">
                     <div class="flex items-center space-x-2">
                       <button id="tabAgenda" class="px-3 py-2 rounded-sm bg-amber-600 text-white font-bold">Agenda</button>
                       <button id="tabInsights" class="px-3 py-2 rounded-sm bg-gray-800 text-gray-300 hover:text-white">Insights</button>
                     </div>
                     <div class="flex items-center space-x-2">
                       <select id="filtroProfissional" class="bg-gray-900 text-white border border-gray-700 rounded px-2 py-2">
                         <option value="">Todos</option>
                         <option value="1">Rafa</option>
                         <option value="2">Tteu</option>
                       </select>
                       <select id="filtroPeriodo" class="bg-gray-900 text-white border border-gray-700 rounded px-2 py-2">
                         <option value="week">Semana</option>
                         <option value="month">Últimos 30 dias</option>
                       </select>
                     </div>
                   </div>
                   <div id="agendaView" class="space-y-3">
                     <div class="flex justify-between items-center">
                       <div class="text-gray-400 text-sm" id="agendaIntervalo"></div>
                       <div class="flex items-center space-x-2">
                         <button id="btnExportCsv" class="text-sm text-gray-300 hover:text-white border border-gray-700 rounded px-3 py-1">Exportar CSV</button>
                       </div>
                     </div>
                     <div id="listaAgenda" class="divide-y divide-gray-800"></div>
                     <div id="agendaVazio" class="text-gray-500 text-center hidden">Sem agendamentos no período.</div>
                   </div>
                   <div id="insightsView" class="hidden space-y-4">
                     <div class="grid grid-cols-3 gap-3">
                       <div class="bg-black/50 border border-gray-800 rounded p-3 text-center">
                         <div class="text-gray-400 text-xs">Receita</div>
                         <div id="metricReceita" class="text-2xl font-bold text-white">-</div>
                       </div>
                       <div class="bg-black/50 border border-gray-800 rounded p-3 text-center">
                         <div class="text-gray-400 text-xs">Agendamentos</div>
                         <div id="metricQtd" class="text-2xl font-bold text-white">-</div>
                       </div>
                       <div class="bg-black/50 border border-gray-800 rounded p-3 text-center">
                         <div class="text-gray-400 text-xs">Ticket médio</div>
                         <div id="metricTicket" class="text-2xl font-bold text-white">-</div>
                       </div>
                     </div>
                     <div class="space-y-6">
                       <div class="bg-black/50 border border-gray-800 rounded p-3">
                         <div class="text-gray-300 mb-2">Receita por dia</div>
                         <canvas id="chartReceitaDia" height="120"></canvas>
                       </div>
                       <div class="bg-black/50 border border-gray-800 rounded p-3">
                         <div class="text-gray-300 mb-2">Por serviço</div>
                         <canvas id="chartServico" height="120"></canvas>
                       </div>
                       <div class="bg-black/50 border border-gray-800 rounded p-3">
                         <div class="text-gray-300 mb-2">Por profissional</div>
                         <canvas id="chartProf" height="120"></canvas>
                       </div>
                     </div>
                   </div>
                 </div>
               </div>
            `;
            document.body.appendChild(overlay);
            const ui = {
              overlay,
              bg: overlay.querySelector('#adminOverlayBg'),
              drawer: overlay.querySelector('#adminDrawer'),
              closeBtn: overlay.querySelector('#adminClose'),
              tabAgenda: overlay.querySelector('#tabAgenda'),
              tabInsights: overlay.querySelector('#tabInsights'),
              agendaView: overlay.querySelector('#agendaView'),
              insightsView: overlay.querySelector('#insightsView'),
              filtroProfissional: overlay.querySelector('#filtroProfissional'),
              filtroPeriodo: overlay.querySelector('#filtroPeriodo'),
              listaAgenda: overlay.querySelector('#listaAgenda'),
              agendaVazio: overlay.querySelector('#agendaVazio'),
              agendaIntervalo: overlay.querySelector('#agendaIntervalo'),
              exportCsv: overlay.querySelector('#btnExportCsv'),
              metricReceita: overlay.querySelector('#metricReceita'),
              metricQtd: overlay.querySelector('#metricQtd'),
              metricTicket: overlay.querySelector('#metricTicket'),
              adminUserName: overlay.querySelector('#adminUserName'),
              open() { overlay.classList.remove('hidden'); },
              close() { overlay.classList.add('hidden'); }
            };
            ui.bg.addEventListener('click', ()=>ui.close());
            ui.closeBtn.addEventListener('click', ()=>ui.close());
            ui.tabAgenda.addEventListener('click', ()=>{
               ui.tabAgenda.classList.add('bg-amber-600','text-white'); ui.tabInsights.classList.remove('bg-amber-600','text-white'); ui.tabInsights.classList.add('bg-gray-800','text-gray-300');
               ui.agendaView.classList.remove('hidden'); ui.insightsView.classList.add('hidden');
            });
            ui.tabInsights.addEventListener('click', ()=>{
               ui.tabInsights.classList.add('bg-amber-600','text-white'); ui.tabAgenda.classList.remove('bg-amber-600','text-white'); ui.tabAgenda.classList.add('bg-gray-800','text-gray-300');
               ui.insightsView.classList.remove('hidden'); ui.agendaView.classList.add('hidden');
            });
            adminUI = ui;
            return ui;
        }
        function buildAuthHeaders(){ const t=getToken(); return { 'Content-Type':'application/json', 'Authorization':'Bearer '+t }; }
        async function fetchAgenda(profId){ const r=await fetch('http://localhost:3000/admin/agendamentos'+(profId?('?_dummy=1&profissional_id='+encodeURIComponent(profId)):'') ,{ headers: buildAuthHeaders()}); const d=await r.json(); if(!r.ok) throw new Error(d.error||'Erro ao carregar agenda'); return d; }
        function renderAgenda(d){ const ui=adminUI; const toBR=(ds)=>{ if(!ds) return ''; const [y,m,da]=ds.split('-'); return `${da}/${m}/${y}`; }; const toBRDateTime=(ts)=>{ if(!ts) return ''; const [date, time=''] = ts.split(' '); const hhmm = time.slice(0,5); return `${toBR(date)} (${hhmm})`; }; ui.agendaIntervalo.textContent = toBR(d.start)+' a '+toBR(d.end); ui.listaAgenda.innerHTML=''; if(!d.items.length){ ui.agendaVazio.classList.remove('hidden'); return; } ui.agendaVazio.classList.add('hidden'); d.items.sort((a,b)=>a.data.localeCompare(b.data)); d.items.forEach(a=>{ const item=document.createElement('div'); item.className='py-3 flex items-center justify-between'; const dt = toBRDateTime(a.data); item.innerHTML=`<div><div class="text-white">${dt} — ${a.servico_nome}</div><div class="text-gray-400 text-sm">${a.profissional_nome}</div></div><div class="text-amber-500 font-bold">${formatBRL(Number(a.preco||0))}</div>`; ui.listaAgenda.appendChild(item); }); }
        let chartDia, chartServico, chartProf; function destroyCharts(){ chartDia?.destroy(); chartServico?.destroy(); chartProf?.destroy(); }
        async function ensureChartJs(){ if(window.Chart) return; await new Promise(res=>{ const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/chart.js'; s.onload=res; document.head.appendChild(s); }); }
        async function fetchInsights(period){ const r=await fetch('http://localhost:3000/admin/insights?period='+encodeURIComponent(period||'week'), { headers: buildAuthHeaders()}); const d=await r.json(); if(!r.ok) throw new Error(d.error||'Erro ao carregar insights'); return d; }
        async function renderInsights(d){ const ui=adminUI; ui.metricReceita.textContent = formatBRL(Number(d.totalReceita||0)); ui.metricQtd.textContent = String(d.totalAgendamentos||0); ui.metricTicket.textContent = d.totalAgendamentos? formatBRL(d.totalReceita/d.totalAgendamentos): formatBRL(0); await ensureChartJs(); destroyCharts(); const ctxDia=document.getElementById('chartReceitaDia').getContext('2d'); chartDia=new Chart(ctxDia,{ type:'bar', data:{ labels:d.porDia.map(x=>x.data.substr(5)), datasets:[{ label:'Receita', data:d.porDia.map(x=>x.receita), backgroundColor:'rgba(245,158,11,0.6)', borderColor:'rgb(245,158,11)', borderWidth:1 }] }, options:{ plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }}); const ctxServ=document.getElementById('chartServico').getContext('2d'); chartServico=new Chart(ctxServ,{ type:'doughnut', data:{ labels:d.porServico.map(x=>x.nome), datasets:[{ data:d.porServico.map(x=>x.receita), backgroundColor:['#f59e0b','#10b981','#3b82f6','#ef4444','#8b5cf6','#22d3ee'] }] }, options:{ plugins:{ legend:{ position:'bottom', labels:{ color:'#d1d5db' } } } }}); const ctxProf=document.getElementById('chartProf').getContext('2d'); chartProf=new Chart(ctxProf,{ type:'bar', data:{ labels:d.porProfissional.map(x=>x.nome), datasets:[{ label:'Receita', data:d.porProfissional.map(x=>x.receita), backgroundColor:'rgba(59,130,246,0.6)', borderColor:'rgb(59,130,246)', borderWidth:1 }] }, options:{ plugins:{ legend:{ display:false } }, scales:{ x:{ ticks:{ color:'#d1d5db' } }, y:{ beginAtZero:true } } }}); }
        function exportAgendaCsv(items){ const rows=[["Data","Serviço","Profissional","Preço"]]; items.forEach(a=>rows.push([a.data,a.servico_nome,a.profissional_nome,String(a.preco)])); const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const link=document.createElement('a'); link.href=url; link.download='agenda.csv'; link.click(); URL.revokeObjectURL(url); }

        function updateAuthUI() {
            const token = localStorage.getItem('token');
            const loginBtn = document.getElementById('loginBtn');
            const userArea = document.getElementById('userArea');
            const userName = document.getElementById('userName');
            const mobileLogin = document.getElementById('mobileLoginLink');
            const mobileUserArea = document.getElementById('mobileUserArea');
            const mobileUserName = document.getElementById('mobileUserName');
            const payload = token && isTokenValid(token) ? getPayload(token) : null;
            const adminBtn = document.getElementById('adminMenuButton');
            if (payload && payload.nome) {
                loginBtn?.classList.add('hidden');
                userArea?.classList.remove('hidden');
                if (userName) userName.textContent = payload.nome;
                mobileLogin?.classList.add('hidden');
                mobileUserArea?.classList.remove('hidden');
                if (mobileUserName) mobileUserName.textContent = payload.nome;
                if (payload.role === 'admin') {
                    adminBtn?.classList.remove('hidden');
                    const ui = createAdminPanel();
                    ui.adminUserName.textContent = '• ' + payload.nome;
                    adminBtn?.addEventListener('click', async () => {
                        ui.open();
                        try {
                          const profId = ui.filtroProfissional.value;
                          const agenda = await fetchAgenda(profId);
                          renderAgenda(agenda);
                          const insights = await fetchInsights(ui.filtroPeriodo.value || 'week');
                          await renderInsights(insights);
                        } catch(e) {}
                    });
                    adminUI?.filtroProfissional?.addEventListener('change', async () => {
                        try { const agenda = await fetchAgenda(adminUI.filtroProfissional.value); renderAgenda(agenda); } catch(e) {}
                    });
                    adminUI?.filtroPeriodo?.addEventListener('change', async () => {
                        try { const insights = await fetchInsights(adminUI.filtroPeriodo.value || 'week'); await renderInsights(insights); } catch(e) {}
                    });
                    adminUI?.exportCsv?.addEventListener('click', async () => {
                        try { const d = await fetchAgenda(adminUI.filtroProfissional.value); exportAgendaCsv(d.items || []); } catch(e) {}
                    });
                } else {
                    adminBtn?.classList.add('hidden');
                }
            } else {
                localStorage.removeItem('token');
                loginBtn?.classList.remove('hidden');
                userArea?.classList.add('hidden');
                mobileLogin?.classList.remove('hidden');
                mobileUserArea?.classList.add('hidden');
                document.getElementById('adminMenuButton')?.classList.add('hidden');
            }
        }
        function logoutAndRefresh() { localStorage.removeItem('token'); updateAuthUI(); }
        document.getElementById('logoutBtn')?.addEventListener('click', logoutAndRefresh);
        document.getElementById('mobileLogoutBtn')?.addEventListener('click', () => { logoutAndRefresh(); mobileMenu.classList.add('hidden'); });
        updateAuthUI();
    </script>
</body>
</html>
